diff --git a/makefile_include.mk b/makefile_include.mk
index a48eefe9..8aed4e3e 100644
--- a/makefile_include.mk
+++ b/makefile_include.mk
@@ -2,27 +2,31 @@
 # Include makefile used by makefile + makefile.shared
 #  (GNU make only)
 
-# The version - BEWARE: VERSION, VERSION_PC and VERSION_LT are updated via ./updatemakes.sh
 VERSION=1.18.2
 VERSION_PC=1.18.2
-# http://www.gnu.org/software/libtool/manual/html_node/Updating-version-info.html
-VERSION_LT=1:1
+# https://semver.org/
+VERSION_MAJOR=1
+VERSION_MINOR=18
+VERSION_PATCH=2
+VERSION_LT=$(VERSION_MAJOR).$(VERSION_MINOR).$(VERSION_PATCH)
 
 # Compiler and Linker Names
 ifndef CROSS_COMPILE
   CROSS_COMPILE:=
 endif
 
+H := \#
+ifeq (CLANG,$(shell printf "$(H)ifdef __clang__\nCLANG\n$(H)endif\n" | $(CC) -E - | grep CLANG))
+  CC_IS_CLANG := 1
+else
+  CC_IS_CLANG := 0
+endif # Clang
+
 # We only need to go through this dance of determining the right compiler if we're using
 # cross compilation, otherwise $(CC) is fine as-is.
 ifneq (,$(CROSS_COMPILE))
 ifeq ($(origin CC),default)
-CSTR := "\#ifdef __clang__\nCLANG\n\#endif\n"
-ifeq ($(PLATFORM),FreeBSD)
-  # XXX: FreeBSD needs extra escaping for some reason
-  CSTR := $$$(CSTR)
-endif
-ifneq (,$(shell echo $(CSTR) | $(CC) -E - | grep CLANG))
+ifneq ($(CC_IS_CLANG), 1)
   CC := $(CROSS_COMPILE)clang
 else
   CC := $(CROSS_COMPILE)gcc
@@ -122,7 +126,7 @@ endif # COMPILE_SMALL
 endif # COMPILE_DEBUG
 
 
-ifneq ($(findstring clang,$(CC)),)
+ifneq ($(CC_IS_CLANG), 1)
 LTC_CFLAGS += -Wno-typedef-redefinition -Wno-tautological-compare -Wno-builtin-requires-header -Wno-missing-field-initializers
 endif
 ifneq ($(findstring mingw,$(CC)),)
